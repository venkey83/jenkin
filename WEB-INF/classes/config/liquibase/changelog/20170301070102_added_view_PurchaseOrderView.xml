<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <property name="now" value="now()" dbms="mysql,h2"/>
    <property name="now" value="current_timestamp" dbms="postgresql"/>
    <property name="now" value="sysdate" dbms="oracle"/>

    <property name="autoIncrement" value="true" dbms="mysql,h2,postgresql,oracle"/>

    <property name="floatType" value="float4" dbms="postgresql, h2"/>
    <property name="floatType" value="float" dbms="mysql, oracle"/>

    <!--
        Added the entity PurchaseOrder.
    -->
    <changeSet id="2019041718400-0" author="jhipster">
        <createView viewName="purchase_order_view"
                    replaceIfExists="true">
            SELECT
            purchase_order.id AS purchase_order_id,
            purchase_order_number,
            purchase_order_date,
            purchase_order_type,
            purchase_order_status,
            invoice_id,
            invoice_status,
            goods_return_notice.id as goods_return_notice_id,
            goods_return_notice.debit_note_status as debit_note_status,
            goods_return_status,
            adhoc_status,
            process_order.id AS process_order_id,
            requirement_number,
            delivery_date,
            process_order.deleted as process_order_deleted,
            items_id,
            process_order_status,
            gl_code_mappings_id,
            buyer_business.id AS buyer_business_id,
            business_outlet_name,
            buyer.id AS buyer_id,
            buyer_code,
            buyer.company_name as buyer_company_name,
            buyer_user.id AS buyer_user_id,
            buyer_user.deleted AS buyer_user_deleted,
            buyer_user.user_id AS user_id,
            supplier.id as supplier_id
            FROM
            purchase_order
            LEFT JOIN
            process_order ON purchase_order.process_order_id = process_order.id
            LEFT JOIN
            buyer_user ON buyer_user.id = process_order.buyer_user_id
            LEFT JOIN
            buyer ON buyer.id = buyer_user.buyer_id
            LEFT JOIN
            buyer_business ON buyer_business.id = process_order.buyer_business_id
            LEFT JOIN
            items ON process_order.items_id = items.id
            LEFT JOIN
            supplier ON items.supplier_id = supplier.id
            LEFT JOIN
            goods_return_notice on purchase_order.goods_return_notice_id = goods_return_notice.id
        </createView>
    </changeSet>
</databaseChangeLog>